#!/usr/bin/env bash

Err() { ! printf '%s\n' "Err: $1" 1>&2 ;}

up() {
	for ((Count = 10#${1:-1}; Count > 0; Count--)); {
		cd .. || break
	}
	unset -v Count
}

lspkg() { # [NAME] Inspired by TFL/LL
	for File in /var/cache/pacman/pkg/*; {
		[[ $File == *'.sig' ]] ||
			printf '%s\n' "${File#/var/cache/pacman/pkg/}"
	}
}

build() {
	# Check if AUR up to date or not
	git --git-dir="${1%%/}"/.git pull || return 1

	# Set build dir
	local BuildDir="${TMPDIR:-/tmp}/build-$SRANDOM"

	# Copy AUR to build dir
	if cp -r "$1" "$BuildDir"; then
		# Build AUR
		{ cd "$BuildDir" && makepkg -sir ;} || Err "Build '$1' failed..."
	else
		Err "Copy '$1' to '$TMPDIR' failed..."
	fi

	# Clean
	cd "$OLDPWD" && rm -rf "$BuildDir"
}

log() {
	git --no-pager log --reverse --pretty=format:'%h: "%s"' "$@"
	printf '\n'
}


check() {
	for Dir in "${1:-.}"/*; { git --git-dir="$Dir"/.git pull 2>/dev/null ;}
	return 0
}
